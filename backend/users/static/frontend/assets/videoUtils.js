async function y(i,s=.1,f=.8){return new Promise((g,E)=>{const e=document.createElement("video");e.muted=!0,e.playsInline=!0,e.preload="auto",e.crossOrigin="anonymous";let a=!1;const c=()=>{e.pause(),e.removeAttribute("src"),e.load(),e.removeEventListener("loadedmetadata",l),e.removeEventListener("seeked",m),e.removeEventListener("error",d)},o=t=>{a||(a=!0,c(),E(t instanceof Error?t:new Error(String(t))))},w=t=>{a||(a=!0,c(),g(t))},d=()=>{var n;const t=(n=e.error)==null?void 0:n.code;o(new Error(`Video loading/decoding error${t?` (code ${t})`:""}`))},u=()=>{try{const t=e.videoWidth,n=e.videoHeight;if(!t||!n){o(new Error("Video dimensions not available (videoWidth/videoHeight are 0)."));return}const r=document.createElement("canvas");r.width=t,r.height=n;const v=r.getContext("2d");if(!v){o(new Error("Failed to get canvas context"));return}v.drawImage(e,0,0,t,n),r.toBlob(h=>{if(!h){o(new Error("Failed to create blob from canvas. If the video is cross-origin, ensure the server sends CORS headers (or use same-origin / a proxy)."));return}w(h)},"image/jpeg",f)}catch(t){o(t)}},m=()=>{requestAnimationFrame(()=>requestAnimationFrame(u))},l=async()=>{try{const t=Number.isFinite(e.duration)?e.duration:0,n=Math.min(Math.max(s,0),t||s);e.readyState<1&&await new Promise(r=>setTimeout(r,0)),e.addEventListener("seeked",m,{once:!0});try{const r=e.play();r&&typeof r.then=="function"&&await r.catch(()=>{}),e.pause()}catch{}e.currentTime=n,setTimeout(()=>{a||u()},1500)}catch(t){o(t)}};e.addEventListener("loadedmetadata",l,{once:!0}),e.addEventListener("error",d),e.src=i,e.load()})}function p(i,s){return new File([i],s,{type:i.type})}export{p as blobToFile,y as extractVideoFrame};
